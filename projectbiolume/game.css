:root{
  --bg:#070a10;
  --panel:#0b1220cc;
  --panel2:#0b1220ee;
  --text:#e9f0ff;
  --muted:#9cb0d6;
  --line:#1b2a4b;
  --accent:#72f7d2;
  --accent2:#7aa6ff;
  --danger:#ff6a88;
  --good:#7dff7a;
  --shadow: 0 10px 30px rgba(0,0,0,.45);
  --radius: 18px;
  --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
}

*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; background: radial-gradient(1200px 700px at 30% 20%, #0b1a2d 0%, var(--bg) 60%); color:var(--text); font-family:var(--font); }

#app{ min-height:100%; display:flex; flex-direction:column; }

.topbar{
  display:flex; justify-content:space-between; align-items:center;
  padding:12px 14px; border-bottom:1px solid var(--line);
  background: linear-gradient(180deg, #070a10 0%, #070a10cc 100%);
  position:sticky; top:0; z-index:10;
}
.brand{ display:flex; align-items:center; gap:10px; }
.brand .dot{ width:10px; height:10px; border-radius:999px; background:var(--accent); box-shadow:0 0 14px rgba(114,247,210,.8); }
.brand .title{ letter-spacing:.18em; font-weight:800; font-size:12px; color:var(--muted); }

.toggles{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end; }

.btn{
  border:1px solid var(--line);
  background:#0b1220;
  color:var(--text);
  padding:10px 12px;
  border-radius:14px;
  cursor:pointer;
  box-shadow: 0 4px 14px rgba(0,0,0,.22);
  transition: transform .06s ease, filter .06s ease, background .12s ease;
  text-decoration:none;
  user-select:none;
}
.btn:hover{ filter:brightness(1.06); }
.btn:active{ transform: translateY(1px); }
.btn.small{ padding:8px 10px; font-size:12px; border-radius:12px; }
.btn.primary{ background: linear-gradient(135deg, rgba(114,247,210,.16), rgba(122,166,255,.16)); border-color: rgba(114,247,210,.35); }
.btn.ghost{ background: transparent; box-shadow:none; }

.stage{
  position:relative;
  flex:1;
  display:flex;
  flex-direction: column;
  justify-content:center;
  align-items:center;
  padding:10px;
  gap: 10px;
}

/* Hide the game visuals while boot/loading to prevent "black grid snap-in" */
.stage.hide-game #game,
.stage.hide-game .hud,
.stage.hide-game #btnStun,
.stage.hide-game .mobile-hint{
  opacity: 0;
  visibility: hidden;
}

.stage #game,
.stage .hud,
.stage #btnStun,
.stage .mobile-hint{
  transition: opacity .2s ease;
}

#game{
  width:min(100%, 1400px);
  height:auto;
  aspect-ratio: 16 / 9;
  background: radial-gradient(900px 500px at 40% 30%, rgba(114,247,210,.09), rgba(0,0,0,.18) 55%, rgba(0,0,0,.45));
  border:1px solid var(--line);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  touch-action: none; /* IMPORTANT: enables smooth drag on mobile */
}

.hud{
  pointer-events:none;
  position: relative;
  width:min(100%, 1400px);
  padding:0 4px;
  display:flex;
  justify-content:space-between;
  gap:12px;
}
.hud-left, .hud-right{
  display:flex;
  flex-direction:column;
  gap:8px;
  background: rgba(10,16,30,.35);
  border:1px solid rgba(27,42,75,.55);
  border-radius: 14px;
  padding:10px 12px;
  backdrop-filter: blur(8px);
}
.hud-row{ display:flex; align-items:baseline; gap:10px; }
.label{ font-size:11px; letter-spacing:.18em; color:var(--muted); font-weight:800; }
.value{ font-weight:900; font-size:14px; }

.overlay{
  position:absolute;
  inset:0;
  display:none;
  place-items:center;
  padding:18px;
  background: rgba(0,0,0,.38);
}
.overlay.show{ display:grid; }
.panel{
  width:min(520px, 92vw);
  background: var(--panel2);
  border:1px solid rgba(27,42,75,.75);
  border-radius: 20px;
  box-shadow: var(--shadow);
  padding:18px 18px 16px;
}
.panel h1{
  margin:0 0 6px;
  font-size:28px;
  letter-spacing:.03em;
}
.panel h2{ margin:0 0 10px; }
.sub{ color:var(--muted); margin:0 0 12px; line-height:1.35; }
.controls{ display:flex; flex-wrap:wrap; gap:8px; margin:10px 0 14px; }
.chip{
  border:1px solid rgba(27,42,75,.75);
  padding:8px 10px;
  border-radius:999px;
  background: rgba(114,247,210,.08);
  font-weight:700;
  font-size:12px;
  color: var(--text);
}
.menu-actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
.hint{ margin-top:12px; color: rgba(156,176,214,.9); font-size:12px; }

.bullets{ margin: 0 0 10px 18px; color: var(--muted); }
.bullets li{ margin:6px 0; }

.hiscores{ margin-top:14px; border-top:1px solid rgba(27,42,75,.65); padding-top:12px; }
.hiscores h2{ font-size:14px; letter-spacing:.12em; color:var(--muted); margin:0 0 8px; }
#scoreList{ margin:0; padding-left:18px; color:var(--text); }
#scoreList li{ margin:6px 0; color: rgba(233,240,255,.92); }
#scoreList small{ color: var(--muted); }

/* Fake loading dots */
.loader{
  display:flex;
  gap:10px;
  margin-top:14px;
  align-items:center;
  justify-content:flex-start;
}
.loader span{
  width:10px;
  height:10px;
  border-radius:999px;
  background: rgba(114,247,210,.9);
  box-shadow: 0 0 14px rgba(114,247,210,.45);
  animation: bob 0.9s infinite ease-in-out;
}
.loader span:nth-child(2){ animation-delay: .12s; }
.loader span:nth-child(3){ animation-delay: .24s; }

@keyframes bob{
  0%,100%{ transform: translateY(0); opacity:.55; }
  50%{ transform: translateY(-6px); opacity:1; }
}

.name-row{
  display:flex; flex-direction:column; gap:6px;
  margin: 10px 0 10px;
}
.name-row label{ font-size:12px; color:var(--muted); letter-spacing:.12em; font-weight:800; }
.name-row input{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(27,42,75,.85);
  background: rgba(10,16,30,.5);
  color: var(--text);
  outline:none;
}
.name-row input:focus{ border-color: rgba(114,247,210,.55); }

.mobile-hint{
  position:absolute;
  bottom:20px;
  left:50%;
  transform: translateX(-50%);
  background: rgba(10,16,30,.6);
  border: 1px solid rgba(27,42,75,.6);
  padding:8px 12px;
  border-radius:999px;
  color: var(--muted);
  font-size:12px;
  display:none;
  pointer-events:none;
}

.footer{
  border-top:1px solid var(--line);
  padding:10px 14px;
  color: var(--muted);
  font-size:12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.sep{ opacity:.6; }

body.is-mobile .stage{
  flex-direction: column;
  justify-content: flex-start; /* was inherited center; this fixes the HUD getting pushed down */
  padding-top: 56px;
  padding-bottom: calc(14px + env(safe-area-inset-bottom));
}

/* Mobile: slightly shorter playfield so HUD doesn't sit under Safari bars */
body.is-mobile #game{
  aspect-ratio: 3 / 4; /* was 11/16 (too tall) */
  width: min(100%, 520px);
}

/* Mobile: keep topbar buttons on ONE line (no wrap) */
body.is-mobile .topbar{
  padding: 10px 10px;          /* slightly tighter */
}

body.is-mobile .toggles{
  flex-wrap: nowrap;           /* IMPORTANT: prevents Close dropping to new line */
  gap: 6px;
}

body.is-mobile .toggles .btn{
  padding: 7px 9px;            /* tighter buttons so all fit */
  font-size: 11px;
  border-radius: 11px;
  white-space: nowrap;
}


#overlayBoot {
  z-index: 9999;
}

body.is-mobile .mobile-hint{
  display: none !important;
}

/* Mobile: make HUD a single compact row */
body.is-mobile .hud{
  flex-direction: row;
  gap: 8px;
}

body.is-mobile .hud-left,
body.is-mobile .hud-right{
  width: auto;
  flex: 1 1 auto;
  flex-direction: row;
  flex-wrap: nowrap;
  align-items: center;
  justify-content: space-between;
  padding: 8px 10px;
}

/* tighten rows */
body.is-mobile .hud-row{
  min-width: 0;
  gap: 8px;
}

body.is-mobile .label{ font-size: 10px; }
body.is-mobile .value{ font-size: 13px; }

/* Mobile: POWER not needed */
body.is-mobile .hud-right .hud-row:nth-child(2){
  display: none;
}

body.is-mobile .footer{
  display: none;
}

/* Mobile brand layout: dot above title */
body.is-mobile .brand{
  display: flex;
  flex-direction: column;   /* STACK dot + text */
  align-items: flex-start;  /* left aligned */
  gap: 4px;
  min-width: 0;
}

body.is-mobile .brand .dot{
  margin-top: 2px;
}

body.is-mobile .brand .title{
  font-size: 10px;
  letter-spacing: .14em;
  line-height: 1.1;

  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 180px;
}

@media (max-width: 360px){
  body.is-mobile .brand .title{
    display: none;
  }
}

/* Mobile: center the dot above the title (without centering the title itself) */
body.is-mobile .brand .dot{
  align-self: center;
}

/* --------------------------------------------
   ARCADE CAPSULE MENU (single overlay pages)
   -------------------------------------------- */

.panel.menu-capsule{
  width: min(520px, 92vw);
  border-radius: 54px;
  padding: 18px 18px 16px;
  position: relative;
  overflow: hidden;

  background:
    radial-gradient(900px 520px at 20% 10%, rgba(114,247,210,.12), rgba(0,0,0,0) 55%),
    radial-gradient(900px 520px at 80% 30%, rgba(122,166,255,.10), rgba(0,0,0,0) 60%),
    rgba(9, 14, 26, .92);

  border: 1px solid rgba(180, 210, 255, .14);
  box-shadow:
    0 18px 60px rgba(0,0,0,.55),
    inset 0 0 0 1px rgba(114,247,210,.10);
}

.menu-ambient{
  position:absolute;
  inset:-40%;
  pointer-events:none;
  background:
    radial-gradient(circle at 30% 20%, rgba(114,247,210,.20), rgba(0,0,0,0) 35%),
    radial-gradient(circle at 70% 40%, rgba(122,166,255,.18), rgba(0,0,0,0) 38%),
    radial-gradient(circle at 45% 75%, rgba(114,247,210,.12), rgba(0,0,0,0) 42%);
  filter: blur(18px);
  opacity: .75;
  animation: menuDrift 10s ease-in-out infinite;
}

@keyframes menuDrift{
  0%,100%{ transform: translate3d(0,0,0) scale(1); }
  50%{ transform: translate3d(18px,-10px,0) scale(1.02); }
}

.menu-header{
  display:flex;
  justify-content:center;
  align-items:center;
  padding: 10px 6px 14px;
}

.menu-title{
  font-weight: 900;
  font-size: 26px;
  letter-spacing: .02em;
  text-shadow:
    0 0 18px rgba(114,247,210,.22),
    0 0 26px rgba(122,166,255,.14);
}

.menu-pages{
  position: relative;
  display:block;

  /* Make the menu usable on short mobile screens */
  height: min(520px, calc(100vh - 220px));
  max-height: calc(100vh - 220px);
}

.menu-page{
  position:absolute;
  inset: 0;
  display:flex;
  flex-direction:column;
  gap: 14px;

  opacity: 0;
  transform: translateX(12px);
  pointer-events:none;

  /* Prevent weird overflow when inactive */
  overflow: hidden;

  transition: opacity .18s ease, transform .18s ease;
}

.menu-page.is-active{
  opacity: 1;
  transform: translateX(0);
  pointer-events:auto;

  /* ✅ Scroll the page if content is too tall (mobile How-to) */
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* iOS smooth scroll */
  overscroll-behavior: contain;

  /* keeps the bottom text from kissing the rounded edge */
  padding-bottom: 10px;
}

/* Credits should NOT be a scroll container (prevents glow clipping + saves vertical space) */
.menu-page.is-active[data-page="credits"]{
  overflow: visible;
}

.menu-page-title{
  font-size: 18px;
  font-weight: 900;
  letter-spacing: .06em;
  color: rgba(233,240,255,.92);
  padding: 0 6px;
}

.menu-list{
  display:flex;
  flex-direction:column;
  gap: 12px;
  padding: 0 6px;
}

.menu-item{
  width:100%;
  text-align:center;
  border-radius: 999px;
  padding: 16px 14px;
  border: 1px solid rgba(180, 210, 255, .14);
  background:
    linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,0)),
    rgba(10,16,30,.55);
  color: rgba(233,240,255,.96);
  font-weight: 900;
  font-size: 16px;
  letter-spacing: .02em;
  cursor:pointer;

  box-shadow:
    0 10px 26px rgba(0,0,0,.35),
    inset 0 0 0 1px rgba(114,247,210,.10);

  transition: transform .08s ease, filter .12s ease, border-color .12s ease;
  user-select:none;
}

.menu-item:hover{
  filter: brightness(1.08);
  border-color: rgba(114,247,210,.26);
}

.menu-item:active{
  transform: translateY(1px) scale(.995);
}

.menu-item.is-primary{
  border-color: rgba(114,247,210,.40);
  background:
    radial-gradient(680px 160px at 40% 0%, rgba(114,247,210,.16), rgba(0,0,0,0) 60%),
    linear-gradient(180deg, rgba(255,255,255,.07), rgba(0,0,0,0)),
    rgba(10,16,30,.62);
  box-shadow:
    0 14px 34px rgba(0,0,0,.42),
    0 0 22px rgba(114,247,210,.14),
    inset 0 0 0 1px rgba(114,247,210,.14);
}

.menu-item.is-locked{
  opacity: .55;
  cursor:not-allowed;
  filter: saturate(.8);
}

.menu-sub{
  display:block;
  margin-top: 4px;
  font-size: 12px;
  font-weight: 800;
  letter-spacing: .08em;
  color: rgba(156,176,214,.95);
}

.menu-footer{
  margin-top:auto;
  padding: 0 6px;
}

.menu-note{
  color: rgba(156,176,214,.92);
  font-size: 12px;
  line-height: 1.35;
}

.menu-note.small{ font-size: 11px; opacity: .9; }

.menu-actions-row{
  display:flex;
  justify-content:center;
  gap: 10px;
  padding: 0 18px;
  flex-wrap:wrap;
}

.menu-actions-row.split{
  justify-content:space-between;
  align-items:center;
}

.tabs{
  display:flex;
  gap: 10px;
  padding: 0 6px;
  flex-wrap:wrap;
}

.tab{
  border-radius: 999px;
  padding: 10px 12px;
  border: 1px solid rgba(180, 210, 255, .14);
  background: rgba(10,16,30,.45);
  color: rgba(233,240,255,.92);
  font-weight: 900;
  cursor:pointer;
}

.tab.is-active{
  border-color: rgba(114,247,210,.35);
  box-shadow: 0 0 16px rgba(114,247,210,.12);
}

.tab.is-locked{
  opacity: .55;
  cursor:not-allowed;
}

.leaderboard{
  padding: 0 6px;
}

.score-list{
  margin:0;
  padding-left: 18px;
  max-height: 260px;
  overflow:auto;
  scrollbar-width: thin;
}

.score-list li{
  margin: 8px 0;
  color: rgba(233,240,255,.92);
}

.btn.danger{
  border-color: rgba(255,106,136,.38);
  background:
    linear-gradient(135deg, rgba(255,106,136,.10), rgba(0,0,0,0)),
    rgba(10,16,30,.55);
}

.how-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  padding: 0 6px;
}

.how-card{
  border-radius: 18px;
  border: 1px solid rgba(180, 210, 255, .12);
  background: rgba(10,16,30,.40);
  padding: 12px 12px;
  box-shadow: inset 0 0 0 1px rgba(114,247,210,.06);
}

.how-head{
  font-weight: 900;
  letter-spacing: .08em;
  color: rgba(233,240,255,.92);
  margin-bottom: 8px;
}

.how-list{
  margin: 0;
  padding-left: 18px;
  color: rgba(156,176,214,.95);
}

.how-list li{ margin: 6px 0; }

.how-rule{
  padding: 0 6px;
  color: rgba(156,176,214,.95);
  line-height: 1.45;
}

.credits{
  padding: 0 6px;
  display:flex;
  flex-direction:column;
  gap: 12px;
}

.credits-block{
  border-radius: 18px;
  border: 1px solid rgba(180, 210, 255, .12);
  background: rgba(10,16,30,.40);
  padding: 12px 12px;
}

.credits-head{
  font-weight: 900;
  letter-spacing: .08em;
  margin-bottom: 6px;
  color: rgba(233,240,255,.92);
}

.credits-line{
  color: rgba(156,176,214,.95);
  line-height: 1.4;
}

/* Credits page: slightly tighter spacing so everything fits without scrolling */
.menu-page[data-page="credits"]{
  gap: 10px; /* was 14 from the base .menu-page */
}

.menu-page[data-page="credits"] .credits{
  gap: 10px; /* was 12 */
}

.menu-page[data-page="credits"] .credits-block{
  padding: 10px 12px; /* was 12px 12px */
}

/* Mobile: stack How-to cards */
body.is-mobile .how-grid{
  grid-template-columns: 1fr;
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .menu-ambient{ animation: none; }
  .menu-page{ transition: none; }
  .menu-item{ transition: none; }
}

body.is-mobile .panel.menu-capsule{
  width: min(520px, 94vw);
}

/* MAIN MENU: spread the buttons vertically (not just center them) */
.menu-page[data-page="main"]{
  display: flex;
  flex-direction: column;
}

/* Give the list real vertical space, then distribute items */
.menu-page[data-page="main"] .menu-list{
  flex: 1 1 auto;
  min-height: 320px;              /* ensures spacing even on desktop */
  display: flex;
  flex-direction: column;
  justify-content: space-around;  /* ✅ THIS is the spread */
  gap: 0;                         /* gap would fight space-evenly */
  padding: 6px 6px;
}

/* Keep tip anchored at the bottom */
.menu-page[data-page="main"] .menu-footer{
  margin-top: 0;
  padding-top: 6px;
}

.credits-line a{
  color: var(--accent);
  text-decoration: none;
  font-weight: 800;
}

.credits-line a:hover{
  text-decoration: underline;
}

/* Credits: put back button in the capsule header area (top-left) */
.menu-capsule{
  position: relative; /* ensures absolute children anchor correctly */
}

/* Credits page ONLY: back button lives in the header space (top-left) */
.menu-page[data-page="credits"]{
  position: relative; /* anchor the absolute button */
}

.menu-page[data-page="credits"] .menu-page-title-row{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;

  /* Pull everything up */
  margin-bottom: 6px;

  /* Less top padding = more room for the credits stack */
  padding: 8px 18px 0;

  /* Allow glow to escape */
  overflow: visible;
}

.menu-page[data-page="credits"] .menu-page-title-row .menu-page-title{
  margin: 0; /* prevent extra spacing fighting the layout */
}

/* The inline back button (inherits your btn styles too) */
.menu-page[data-page="credits"] .credits-back-inline{
  flex: 0 0 auto;
  padding: 8px 12px;
  border-radius: 999px;
  white-space: nowrap;
}

/* --------------------------------------------
   Make ALL "Back" buttons more visible
   Targets any button that navigates back to main
   -------------------------------------------- */

.menu-actions-row .btn.ghost[data-nav="main"],
.menu-page .btn.ghost.small[data-nav="main"],
.menu-page[data-page="credits"] .credits-back-inline{
  background:
    radial-gradient(180px 60px at 30% 20%, rgba(114,247,210,.18), rgba(0,0,0,0) 60%),
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,0)),
    rgba(10,16,30,.72) !important;

  border-color: rgba(114,247,210,.45) !important;

  box-shadow:
    0 14px 30px rgba(0,0,0,.45),
    0 0 22px rgba(114,247,210,.16),
    inset 0 0 0 1px rgba(114,247,210,.16) !important;

  color: rgba(233,240,255,.98) !important;
  font-weight: 900;
  letter-spacing: .02em;
}

/* Hover/press feedback so it feels “arcade-button” */
.menu-actions-row .btn.ghost[data-nav="main"]:hover,
.menu-page .btn.ghost.small[data-nav="main"]:hover,
.menu-page[data-page="credits"] .credits-back-inline:hover{
  filter: brightness(1.12);
  border-color: rgba(114,247,210,.62) !important;
}

.menu-actions-row .btn.ghost[data-nav="main"]:active,
.menu-page .btn.ghost.small[data-nav="main"]:active,
.menu-page[data-page="credits"] .credits-back-inline:active{
  transform: translateY(1px) scale(.995);
}

/* Optional: subtle “notice me” pulse (safe + classy) */
@media (prefers-reduced-motion: no-preference){
  .menu-actions-row .btn.ghost[data-nav="main"],
  .menu-page[data-page="credits"] .credits-back-inline{
    animation: backPulse 2.8s ease-in-out infinite;
  }
  @keyframes backPulse{
    0%,100%{ box-shadow:
      0 14px 30px rgba(0,0,0,.45),
      0 0 18px rgba(114,247,210,.10),
      inset 0 0 0 1px rgba(114,247,210,.16);
    }
    50%{ box-shadow:
      0 14px 30px rgba(0,0,0,.45),
      0 0 26px rgba(114,247,210,.22),
      inset 0 0 0 1px rgba(114,247,210,.22);
    }
  }
}
